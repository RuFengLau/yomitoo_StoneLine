"use strict";const fs=require("fs"),path=require("path"),Imager=require("./Imager"),FileUtil=require("./utils/file-util"),ConfigManager=require("./utils/config-manager"),buildDir=path.join(Editor.Project.path,"build");function startCompress(){var i=ConfigManager.get();let e=i.inputDir,r=(e=e||path.join(buildDir,"wechatgame"),i.cacheDir),t=(r=r||path.join(buildDir,"imageCache"),"igno=");i.excludeFiles&&(t+=""+i.excludeFiles),i.imageMin&&(t+="&min="+i.imageMin),i.imageMax&&(t+="&max="+i.imageMax),i.imageType&&(t+="&exts="+i.imageType),Imager.compress(e,r,t)}module.exports={load(){Editor.Builder.on("build-start",this.onBuildStart),Editor.Builder.on("build-finished",this.onBuildFinished)},unload(){Editor.Builder.removeListener("build-start",this.onBuildStart),Editor.Builder.removeListener("build-finished",this.onBuildFinished)},messages:{"open-panel"(){Editor.Panel.open("imager2x")},"start-compress"(){startCompress()},"save-config"(i,e){e=ConfigManager.set(e);Editor.log("[imager]","配置已保存",e),i.reply(null,!0)},"read-config"(i){var e=ConfigManager.get();e?Editor.log("[imager]","读取本地配置"):Editor.log("[PAC]","未找到本地配置文件"),i.reply(null,e)}},onBuildStart(i,e){var r=ConfigManager.get();r&&r.isAutoStart&&Editor.log("[imager]","将在构建完成后自动压缩图片"),e&&e()},onBuildFinished(i,e){var r=ConfigManager.get();r&&r.isAutoStart&&(Editor.log("[imager]","准备压缩图片...."),startCompress()),e&&e()}};